---
title: "Chemeketa Course Analysis"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: scroll
    theme:
      version: 4
      bg: '#FFFFFF'
      fg: '#522c1b'
      primary: '#6b6f2a'
      navbar-bg: '#522c1b'
      base_font:
        google: Open Sans
      heading_font:
        google: Open Sans
      code_font:
        google: Fira Code

---

Executive Summary {data-orientation=rows}
================================================================================

Row {data-height=600}
-----------------------------------------------------------------------



```{r setup, include=FALSE}
library(tidyverse)
library(flexdashboard)
library(crosstalk)
library(plotly)
library(DT)

chemeketa_data <- read.csv("Data Set for IRR Director Interview Presentation.txt")

instruction_mode <- chemeketa_data %>%
  group_by(CAMPUS) %>%
  filter(n() >= 100) %>%
  ungroup() %>%
  filter(str_sub(TERM_CODE,-2) != "10") 

by_subject_and_campus = instruction_mode %>%
  group_by(TERM_CODE, TERM_DESCRIPTION, CAMPUS, SUBJECT, DELIVERY_METHOD) %>%
  summarize(Total_Sections = n(), 
            Total_Enrolled = sum(TOTAL_ENROLL, na.rm = TRUE),
            Total_FTE = sum(TOTAL_FTE, na.rm = TRUE),
            C_OR_BETTER = sum(C_OR_BETTER, na.rm = TRUE) / Total_Enrolled,
            Avg_Class_Size = Total_Enrolled/Total_Sections) %>%
  mutate(TERM_CODE = factor(TERM_CODE, levels = unique(TERM_CODE), labels = unique(TERM_DESCRIPTION))) %>%
  ungroup()

all_subjects = instruction_mode %>%
  group_by(TERM_CODE, TERM_DESCRIPTION, CAMPUS, DELIVERY_METHOD) %>%
  summarize(Total_Sections = n(), 
            Total_Enrolled = sum(TOTAL_ENROLL, na.rm = TRUE),
            Total_FTE = sum(TOTAL_FTE, na.rm = TRUE),
            C_OR_BETTER = sum(C_OR_BETTER, na.rm = TRUE) / Total_Enrolled,
            Avg_Class_Size = Total_Enrolled/Total_Sections) %>%
  mutate(TERM_CODE = factor(TERM_CODE, levels = unique(TERM_CODE), labels = unique(TERM_DESCRIPTION))) %>%
  ungroup() %>%
  mutate(SUBJECT = "All Subjects")

all_campuses = instruction_mode %>%
  group_by(TERM_CODE, TERM_DESCRIPTION, SUBJECT, DELIVERY_METHOD) %>%
  summarize(Total_Sections = n(), 
            Total_Enrolled = sum(TOTAL_ENROLL, na.rm = TRUE),
            Total_FTE = sum(TOTAL_FTE, na.rm = TRUE),
            C_OR_BETTER = sum(C_OR_BETTER, na.rm = TRUE) / Total_Enrolled,
            Avg_Class_Size = Total_Enrolled/Total_Sections) %>%
  mutate(TERM_CODE = factor(TERM_CODE, levels = unique(TERM_CODE), labels = unique(TERM_DESCRIPTION))) %>%
  ungroup() %>%
  mutate(CAMPUS = "All Campuses")

all_subjects_and_campuses = instruction_mode %>%
  group_by(TERM_CODE, TERM_DESCRIPTION, DELIVERY_METHOD) %>%
  summarize(Total_Sections = n(), 
            Total_Enrolled = sum(TOTAL_ENROLL, na.rm = TRUE),
            Total_FTE = sum(TOTAL_FTE, na.rm = TRUE),
            C_OR_BETTER = sum(C_OR_BETTER, na.rm = TRUE) / Total_Enrolled,
                        Avg_Class_Size = Total_Enrolled/Total_Sections) %>%
  mutate(TERM_CODE = factor(TERM_CODE, levels = unique(TERM_CODE), labels = unique(TERM_DESCRIPTION))) %>%
  ungroup() %>%
  mutate(SUBJECT = "All Subjects and Campuses",
         CAMPUS = "All Subjects and Campuses")


data_for_graphs = bind_rows(by_subject_and_campus, all_campuses, all_subjects, all_subjects_and_campuses) %>%
  bind_rows(., tibble(SUBJECT = " ", 
                      CAMPUS = " ")) %>%
  mutate(C_OR_BETTER = round(C_OR_BETTER, 2),
         Avg_Class_Size = round(Avg_Class_Size, 2)) %>%
  relocate(Avg_Class_Size, .after = Total_Enrolled)

shared_data_for_graphs <- SharedData$new(data_for_graphs)
shared_data_for_graphs2 <- SharedData$new(data_for_graphs)


```

<style>
.sidebar-nav {visibility: hidden}
.dataTables_scrollBody{max-width: 95% !important; }
</style>

Enrollment {data-orientation=rows}
================================================================================

{.sidebar}
--------------------------------------------------------------------------------

```{r}
filter_select(id = "SUBJECT ", label = "Subject",  sharedData = shared_data_for_graphs, ~SUBJECT, multiple = F)
filter_select(id = "CAMPUS ", label = "Term",  sharedData = shared_data_for_graphs, ~CAMPUS)


```

```{js}
function filter_default(){
  document.getElementById("SUBJECT ").getElementsByClassName("selectized")[0].selectize.setValue(" ", false)
  document.getElementById("CAMPUS ").getElementsByClassName("selectized")[0].selectize.setValue(" ", false)
}
$(document).ready(filter_default);
```

Row {data-height=600}
-----------------------------------------------------------------------


### Total Sections

```{r}

plot_ly(shared_data_for_graphs, 
        x = ~TERM_CODE, 
        y = ~Total_Sections, 
        color = ~DELIVERY_METHOD, 
        colors = c("#6b6f2a", "#522c1b", "#f6d654", "#569099"), 
        type="scatter", 
        mode="lines+markers") %>%
  layout(xaxis = list(title = "Term Code", tickangle = 90),
         yaxis = list(title = "Total Sections"))

```

### Total Enrolled

```{r}

plot_ly(shared_data_for_graphs, 
        x = ~TERM_CODE, 
        y = ~Total_Enrolled, 
        color = ~DELIVERY_METHOD, 
        colors = c("#6b6f2a", "#522c1b", "#f6d654", "#569099"), 
        type="scatter", 
        mode="lines+markers") %>%
  layout(xaxis = list(title = "Term Code", tickangle = 90),
         yaxis = list(title = "Number of Students Enrolled"))

```

Row {data-height=400}
-----------------------------------------------------------------------

### Average Class Size

```{r}

plot_ly(shared_data_for_graphs, 
        x = ~TERM_CODE, 
        y = ~Avg_Class_Size, 
        color = ~DELIVERY_METHOD, 
        colors = c("#6b6f2a", "#522c1b", "#f6d654", "#569099"), 
        type="scatter", 
        mode="lines+markers") %>%
  layout(xaxis = list(title = "Term Code", tickangle = 90),
         yaxis = list(title = "Average Class Size"))

```


Row {data-height=600}
-----------------------------------------------------------------------

### Data

```{r}
datatable(shared_data_for_graphs, 
          class = "display",
          extensions = "Buttons", 
          options = list(dom = 'Bfrtip',
                         pagelength = 200,
                         scrollY = "600px",
                         buttons = list('copy', 'csv', 'excel'),
                         columnDefs = list(list(visible = FALSE, targets = c(0))))
          )

```




Grades {data-orientation=rows}
================================================================================

{.sidebar}
--------------------------------------------------------------------------------

```{r}
filter_select(id = "SUBJECT  ", label = "Subject",  sharedData = shared_data_for_graphs2, ~SUBJECT, multiple = F)
filter_select(id = "CAMPUS  ", label = "Term",  sharedData = shared_data_for_graphs2, ~CAMPUS)


```

```{js}
function filter_default(){
  document.getElementById("SUBJECT  ").getElementsByClassName("selectized")[0].selectize.setValue(" ", false)
  document.getElementById("CAMPUS  ").getElementsByClassName("selectized")[0].selectize.setValue(" ", false)
}
$(document).ready(filter_default);
```

Row {data-height=600}
-----------------------------------------------------------------------


### Quality Grades

```{r}

plot_ly(shared_data_for_graphs2, 
        x = ~TERM_CODE, 
        y = ~C_OR_BETTER, 
        color = ~DELIVERY_METHOD, 
        colors = c("#6b6f2a", "#522c1b", "#f6d654", "#569099"), 
        type="scatter", 
        mode="lines+markers") %>%
  layout(xaxis = list(title = "Term Code", tickangle = 90),
         yaxis = list(title = "C or Better (%)"))

```

Row {data-height=600}
-----------------------------------------------------------------------

### Data

```{r}
datatable(shared_data_for_graphs2, 
          class = "display",
          extensions = "Buttons", 
          options = list(dom = 'Bfrtip',
                         pagelength = 200,
                         scrollY = "600px",
                         buttons = list('copy', 'csv', 'excel'),
                         columnDefs = list(list(visible = FALSE, targets = c(0))))
          )

```

Definitions {data-orientation=rows}
================================================================================


Row {data-height=600}
-----------------------------------------------------------------------

<span style="font-size: 24px !important;">Definitions</span>
<br>
<br>
<b>Inclusion Criteria: </b> In order for a campus to be included, an enrollment of at least 
<br>
<b>Total Sections: </b>
<br>
<b>Total Enrollment: </b> 
<br>
<b>Average Class Size: </b>
<br>
<b>Quality Grades: </b>
<br>
<b>Efficiency: </b>
<br>
<b>Effectiveness: </b>


